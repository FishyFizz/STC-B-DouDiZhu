C51 COMPILER V9.60.0.0   BUTTON                                                            06/28/2022 02:25:29 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BUTTON
OBJECT MODULE PLACED IN .\Objects\button.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE Src\button\button.c OMF2 OPTIMIZE(0,SPEED) BROWSE DEFINE(STC)
                    - DEBUG PRINT(.\Listings\button.lst) TABS(2) OBJECT(.\Objects\button.obj)

line level    source

   1          #include "button.h"
   2          #include "../adc/adsensor.h"
   3          
   4          XDATA u8 __nav_btn3_state = 0xff;
   5          
   6          XDATA u8 last2_btn_state    =0;
   7          XDATA u8 last_btn_state     =0;
   8          XDATA u8 curr_btn_state     =0;
   9          XDATA u8 btnstate_posedge   =0;
  10          XDATA u8 btnstate_negedge   =0;
  11          
  12          void buttons_init()
  13          {
  14   1          //Initialize ADC for Nav and Button3
  15   1          adc_init();
  16   1      
  17   1          //Set Button1 and Button2 pin to Weak Pullup (M1 = 0, M0 = 0)
  18   1          P3M1 &= 0xF3;   // 1111 0011
  19   1          P3M0 &= 0xF3;   // 1111 0011
  20   1      
  21   1          //Set P17 to Weak Pullup (M1 = 0, M0 = 0)
  22   1          //P17 Pullup -> Key3 -> Nav Button(different resistance) -> GND
  23   1          P1M1 &= 0x7F; // 0111 1111
  24   1          P1M0 &= 0x7F; // 0111 1111
  25   1      }
  26          
  27          void update_button_state()
  28          {
  29   1          last2_btn_state = last_btn_state;
  30   1          last_btn_state = curr_btn_state;
  31   1          curr_btn_state = 0;
  32   1      
  33   1          update_nav_btn3_state();
  34   1      
  35   1          curr_btn_state |= BUTTON1       ?BTNSTATE_B1    :0;
  36   1          curr_btn_state |= BUTTON2       ?BTNSTATE_B2    :0;
  37   1      
  38   1          curr_btn_state |= IS_BTN3_PUSH  ?BTNSTATE_B3    :0;
  39   1      
  40   1          curr_btn_state |= IS_NAV_LEFT   ?BTNSTATE_LEFT  :0;
  41   1          curr_btn_state |= IS_NAV_RIGHT  ?BTNSTATE_RIGHT :0;
  42   1          curr_btn_state |= IS_NAV_UP     ?BTNSTATE_UP    :0;
  43   1          curr_btn_state |= IS_NAV_DOWN   ?BTNSTATE_DOWN  :0;
  44   1          curr_btn_state |= IS_BTN3_PUSH  ?BTNSTATE_PUSH  :0;
  45   1      
  46   1          // 2 recent samples must be same (buttons stabilized)
  47   1          if(curr_btn_state != last_btn_state)
  48   1          {
  49   2              btnstate_negedge = btnstate_posedge = 0;
  50   2              return;
  51   2          }
  52   1      
  53   1          //different with previous detection, and currently set -> posedge
  54   1          btnstate_posedge = (curr_btn_state ^ last2_btn_state) & (curr_btn_state);   
C51 COMPILER V9.60.0.0   BUTTON                                                            06/28/2022 02:25:29 PAGE 2   

  55   1      
  56   1          //different with previous detection, and previously set -> negedge
  57   1          btnstate_negedge = (curr_btn_state ^ last2_btn_state) & (last2_btn_state);
  58   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    424    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
